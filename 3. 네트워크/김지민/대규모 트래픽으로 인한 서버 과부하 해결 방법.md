# 전이중화 통신, CSMA/CD
#### 전이중화 통신(full duplex)이란?
양쪽 장치가 동시에 송수신할 수 있는 방식을 말함.
송신로와 수신로를 나눠서 데이터를 주고 받을 수 있음.
![](https://velog.velcdn.com/images/shypanda0119/post/68a1932f-3df5-4527-8e24-22dd10695360/image.png)

#### CSMA/CD
이전에는 유선 LAN에 '반이중화 통신'중 하나인 CSMA/CD(Carrier Sense Multiple Access with Collision Detection) 방식을 사용. 이방식은 회선을 사용하는지 파악한 후 사용하지 않는다면 데이터를 보내고 충돌이 발생한다면 일정 시간 이후 재전송하는 방식을 말함 

# 반이중화 통신, CSMA/CA, 와이파이
#### 반이중화 통신(half duplex)이란?
양쪽 장치는 서로 통신할 수 있지만, 동시에는 통신할 수 없으며 한번에 한 방향만 통신할 수 있는 방식을 말함

#### CSMA/CA
반이중화 통신 중 하나로 장치에서 데이터를 보내기 전에 일련의 과정을 기반으로 사전에 가능한 충돌을 방지하는 방식

#### 무선 LAN(2.4GHz)
- 장애물에 강하나 속도가 더 느림
- 호완성 좋음(오래된 노트북, 휴대폰과도 연결 가능)
- 커버러지가 높음

#### 무선 LAN(5GHz)
- 장애물이 있을 때 연결이 끊기기도 하나 속도가 더 빠름.
- 호완성이 낮음
- 커버리지가 작음

# 대규모 트래픽으로 인한 서버 과부화 해결방법
#### 서버 과부하란?
서버가 리소스를 소진하여 들어오는 요청을 처리하지 못할 때 발생, 이 때 서버는 사용자의 웹요청을 처리하지 못해 응답없음이 뜨게 됨

## 1. 모니터링을 통한 자원 할당
서버가 응답없음이 뜨는 것은 여러가지 이유가 있지만 그 중 하나가 바로 "**자원의 한계점 도달**" 보통 서버의 CPU 사용량이 80-90%에 도달하거나 메모리가 부족해 계속해서 스와핑이 발생하면 과부화 상태가 됨. 이를 모니터링을 통한 자원의 적절한 할당으로 해결

- AWS 오토 스케일링
서비스 이용불가능 상태 발생 이전 cloud watch가 계속해서 모니터링하여 서버 대수를 늘려주는 방법
AWS Auto Scaling은 애플리케이션을 자동으로 모니터링하고 자원의 용량을 자동으로 조정

- netdata를 이용한 모니터링
AWS를 사용하지 않고 netdata를 사용하는 방법도 존재

Q. 모니터링을 하는 이유?
- 어떤 페이지에 어느 트래픽이 얼마나 발생했느냐
- 어떤 네트워크에서 병목현상이 일어났냐
- 활용도가 낮은 페이지, 높은 페이지를 파악할 수 있어 서비스 개선에 도움이 됨

### 로드밸런서
앞에서 말한 AWS 오토스케일링은 빠르긴 하나 구성에 시간이 걸리기 때문에 앞단에 로드밸런서를 통해 트래픽을 분산해야 함
![](https://velog.velcdn.com/images/shypanda0119/post/c0d37c54-233a-4686-b5ef-8f83f9aeffc6/image.png)
또한, 로드밸런서는 한 서버에 장애가 발생하면 로드 밸런서는 트래픽을 다른 기능 서버로 리디렉션하여 시스템 중단을 방지할 수 있음

### 블랙스완 프로토콜이란?
예측할 수 없는 사고가 일어난 것을 말하며, 사후에는 이 사고의 원인 등을 분석할 수 있지만 사전에는 이 사고를 예측할 수 없는 것을 말함4

Q. 블랙스완 대비하기
- 영향을 받은 시스템과 각 시스템의 상대적 위험 수준을 확인
- 잠재적으로 영향을 받을 수 있는 내부의 모든 팀에 연락
- 최대한 빨리 취약점에 영향을 받는 모든 시스템을 업데이트
- 복원계획을 포함한 우리의 대응 과정을 파트너와 고객 등 외부에 전달

## 2. 서킷 브레이커
서킷브레이커 패턴이라고도 불리며 서비스 장애를 감지하고 연쇄적으로 생기는 에러를 방지하는 기법, 서비스와 서비스 사이에 서킷브레이커 계층을 두고 미리 설정해놓은 timeout 임계값에 도달하면 서킷브레이커가 그 이후의 추가 호출에 무조건 에러를 반환하게 함
대표적으로 구현된 라이브러리는 넷플릭스의 Hystrix와 Resilience4j

- 필요한 사례 첫번째: 스레드의 차단
하나의 스레드가 차단되는 것은 괜찮지만, 예를 들어 100개의 스레드가 있고 그 중 98개의 요청이 에러가 있는 서비스에 요청을 한다면 나머지 2개의 요청은 차단 됨
![](https://velog.velcdn.com/images/shypanda0119/post/80765f11-80a8-4652-b3ee-2905ed6c76f2/image.png)

- 필요한 사례 두번째: 계단식 실패 발생
서비스A에 장애가 난다면 이어져있는 B, C, D 서비스의 응답도 지연되게 되며 계단식 실패가 발생
![](https://velog.velcdn.com/images/shypanda0119/post/f21c090c-559f-42c0-8309-97cc8ab7bf32/image.png)

### 서킷 브레이커의 상태
서킷브레이커는 closed, open, half_open의 상태값을 가짐
- closed(정상) : 네트워크 요청의 실패율이 임계치보다 낮음
- open(에러) : 임계치이상의 상태를 말함. 요청을 서비스로 전송하지 않고 바로 오류를 반환하며 이를 fail fast라 함
- half_open(확인중) : open 상태에서 일정 timeout으로 설정된 시간이 지나면 장애가 해결되었는지 확인하기 위해 half_oepn 상태로 전환되며 요청을 전송하여 응답을 확인함. 장애가 풀리는지 확인해서 성공하면 closed, 실패하면 다시 open으로 변경
![](https://velog.velcdn.com/images/shypanda0119/post/9b9166b3-28c8-4ea1-828e-b9c197862b8b/image.png)

### 서킷 브레이커의 장점
연속적인 에러 발생을 막아주며 일부서비스가 종료되더라도 다른 서비스들은 이상없이 동작하게 만들 수 있으며 사용자경험을 높여 줌.

## 3. 컨첸츠 관리
- 불필요한 컨턴츠 제거
- CDN을 통한 컨텐츠 제공
- 컨텐츠 캐싱
- 컨텐츠 압축
- 컨텐츠의 우하한 저하(미리 준비된 응답)
