# TCP/IP 4계층 모델
장치들이 인터넷상에서 데이터를 주고받기 위한 프로토콜의 집합으로, 실무에서 가장 많이 사용되는 모델.

## 애플리케이션 계층 (Application Layer)
사용자와 소프트웨어가 네트워크와 통신하는 기능을 담당하는 최상위 계층.

* **주요 프로토콜**:
  * **HTTP/HTTPS**: 웹 서비스 (포트 80/443)
  * **SMTP**: 메일 전송 (포트 25)
  * **FTP**: 파일 전송 (포트 20/21)
  * **SSH**: 보안 원격 접속 (포트 22)

## 전송 계층 (Transport Layer)
애플리케이션 계층에서 내려온 데이터를 목적지까지 신뢰성 있게 전달하는 역할.

* **TCP**: 연결 지향형, 신뢰성 보장. **PDU: 세그먼트 (Segment)**
* **UDP**: 비연결형, 속도 우선. **PDU: 데이터그램 (Datagram)**
* **특징**: 포트 번호를 사용하여 응용 프로그램을 구분하고 오류 제어 및 흐름 제어를 수행.

## 인터넷 계층 (Internet Layer)
전송 계층에서 받은 세그먼트(TCP) 또는 데이터그램(UDP)을 패킷화하여, 목적지 IP 주소까지 최적의 경로로 보내는 라우팅 역할을 수행.
* **주요 프로토콜**: IP, ICMP, ARP
* **PDU**: 패킷 (Packet)

## 링크 계층 (Link Layer)
데이터가 물리적 전송 매체(전선, 광섬유, Wi-Fi 등)를 통해 실제로 전달되는 방식을 정의.
* **특징**: 데이터 링크 계층(L2)과 물리 계층(L1)을 합친 형태.
* **PDU**: 프레임 (Frame) / 비트 (Bit)

# OSI 7계층 vs TCP/IP 4계층

TCP/IP 모델은 실무적인 프로토콜 집합이라면, OSI 7계층은 네트워크 통신을 더욱 세부적으로 나눈 표준 참조 모델이다.

## 계층 비교

| TCP/IP 4계층 | OSI 7계층 | 특징 |
| :--- | :--- | :--- |
| **애플리케이션** | **7. 애플리케이션** | 사용자 인터페이스, HTTP, FTP 등 서비스 제공 |
| | **6. 프레젠테이션** | **데이터 형식 변환(인코딩/디코딩), 암호화/복호화**, 압축 |
| | **5. 세션** | **통신 세션 관리**(연결 유지 및 종료), 동기화 |
| **전송** | **4. 전송** | 종단 간 신뢰성 있는 데이터 전송 (TCP/UDP) |
| **인터넷** | **3. 네트워크** | 최적의 경로 설정 (**라우팅**), IP 주소 관리 |
| **링크** | **2. 데이터 링크** | 물리적 연결을 통한 인접 노드 간 전송, **MAC 주소** 사용 |
| | **1. 물리** | 전기적, 기계적 신호를 통해 **비트(0,1)** 전송 |

## 캡슐화(Encapsulation) & 비캡슐화(Decapsulation)

계층간 이동하는 데이터의 헤더를 추가하거나 제거해나가는 과정. 각 계층이 독립적으로 작동하는 모듈화를 가능하게 한다.

### 캡슐화 (송신 측)
상위 계층의 데이터를 하위 계층이 받아서 자신의 **헤더(Header)**를 덧붙이는 과정.

1. **Application**: 데이터 생성. (예: 사용자가 이메일을 작성하고 전송 버튼 클릭)
2. **Transport**: 데이터를 **세그먼트(segment)**로 만들고 TCP 헤더(포트 번호 등) 추가
3. **Internet**: IP 헤더(IP 주소 등) 추가하여 **패킷(packet)**을 만듦
4. **Link**: 프레임 헤더(MAC 주소 등)와 트레일러(오류 검출용) 를 추가하여 **프레임(frame)**을 만듦
5. **물리 계층**: 프레임을 전기 신호나 광 신호로 변환하여 전송

### 비캡슐화 (수신 측)
하위 계층에서 상위 계층으로 올라가며 헤더를 하나씩 제거하고 최종적으로 원래의 데이터를 확인하는 과정.

---

## 오류 검출 방식 (Checksum & CRC)

데이터 전송 중 비트가 뒤바뀌는 등 데이터가 손상되었는지 확인하는 과정.

### 체크섬 (Checksum)
송신 측에서 데이터를 다 더하여 보낸 값을 수신 측에서 다시 계산해 비교하는 방식.
* **사용**: IPv4 헤더, TCP/UDP 헤더
* **알고리즘 (1의 보수합)**:
    1. 데이터를 16비트 단위로 나누기.
    2. 모든 16비트 단위 값을 더하기.
    3. **순환 캐리(End-around carry)**: 더하는 도중 16비트를 넘어가는 값(Carry)이 발생하면, 이를 버리지 않고 다시 맨 뒤에 더하기.
    4. 최종 합계를 반전(0은 1로, 1은 0으로)시켜 **체크섬** 생성.
* **검증**: 수신 측은 `데이터 + 체크섬`을 모두 더하여, 결과가 **0xFFFF** (모든 비트가 1)가 나오면 오류가 없는 것으로 판단.



### CRC (Cyclic Redundancy Check)
데이터를 다항식으로 간주하고 이진 나눗셈을 이용해 오류를 찾아내는 방식.
* **사용**: Ethernet 프레임 트레일러(FCS)
* **알고리즘 (XOR 나눗셈)**:
    1. 원본 데이터 뒤에 (다항식 차수 만큼)의 0을 붙이기.
    2. 미리 약속된 다항식(나누는 수)으로 **XOR 기반 이진 나눗셈**을 수행.
    3. 남은 **나머지 값**이 CRC(체크섬)가 됨.
    4. 원본 데이터 뒤에 이 CRC를 붙여서 전송.
* **검증**: 수신 측은 받은 데이터를 동일한 다항식으로 나눔. 나머지가 **0**이면 오류 없음, 0이 아니면 데이터 손상으로 판단.



### 체크섬, CRC 비교
| 구분 | 체크섬 (Checksum) | CRC (Cyclic Redundancy Check) |
| :--- | :--- | :--- |
| **알고리즘** | 1의 보수합 (덧셈 중심) | 다항식 나눗셈 (XOR 중심) |
| **특징** | 구현이 단순하고 빠름 | 계산은 복잡하나 검출 능력이 강력함 |
| **위치** | 계층마다 헤더에 포함 | 링크 계층 프레임 끝(FCS)에 포함 |


# 데이터 전송 규격 
## MTU (Maximum Transmission Unit)
네트워크 장치가 한 번에 전송할 수 있는 IP 패킷의 최대 크기. 

경로상 모든 장비의 MTU가 다르며, 중간에 작은 MTU를 가진 장비를 만나면 패킷이 분할된다. 일반적으로 1500바이트.

- MTU (L3): IP 패킷 전체 크기 (IP 헤더 + 전송 계층 헤더 + 데이터)

- MSS(Maximum Segment Size) (L4): TCP 세그먼트 내 **순수 데이터(Payload)**만의 크기

### 전송 프로토콜별 데이터 최대치
- TCP: `MSS(1460) = MTU(1500) - IP헤더(20) - TCP헤더(20)`

- UDP: MSS 개념 없음. `최대 데이터(1472) = MTU(1500) - IP헤더(20) - UDP헤더(8)`


#### MTU 확인 방법
1. ping 사용
Windows: `ping [주소] -f -l [바이트]`

- `f`: 분할 방지 설정 (DF)
- `l`: 전송 데이터 크기 (1472 보낼 시 IP(20)+ICMP(8) 더해져 1500으로 전송됨)

2. netsh 사용
`netsh interface ipv4 show interfaces`

## IP 버전별 패킷 분할
- IPv4: 헤더의 DF(Don't Fragment) 플래그가 1이면 분할 금지. 

- IPv6: 라우터 수준의 분할을 아예 허용하지 않음. 패킷이 크면 즉시 폐기 후 ICMPv6(Packet Too Big) 메시지를 전송. 

## PMTUD (Path MTU Discovery)
송신자와 수신자 사이 경로 중 **가장 작은 MTU(Path MTU)**를 자동으로 찾아내는 과정.

- **원리**:
  1. DF 플래그를 세워 패킷 전송
  2. 경로상 장비가 패킷을 폐기하며 ICMP Fragmentation Needed 메시지 반환
  3. 송신자는 메시지를 확인하며 패킷 크기를 단계적으로 줄여 반복 전송
  4. 오류 없이 전달되는 최대 크기를 최종 Path MTU로 확정

- **장점**: 수신 측의 재조립 부담을 줄이고 네트워크 효율을 높임.

---

## 퀴즈

<details>
<summary><b>Q: TCP/IP 계층화 구조의 가장 큰 장점은 무엇인가요?</b></summary>
<div markdown="1">
<b>A:</b> 각 계층이 독립적으로 <b>모듈화</b>되어 있다는 것입니다. 예를 들어 하드웨어(링크 계층)가 광케이블에서 무선(Wi-Fi)으로 바뀌더라도 상위 애플리케이션(HTTP)은 아무런 수정 없이 그대로 작동할 수 있는 유연성을 제공합니다.
</div>
</details>

<details>
<summary><b>Q: IP 헤더에도 체크섬이 있는데 TCP/UDP 헤더에 또 체크섬이 있는 이유는?</b></summary>
<div markdown="1">
<b>A:</b> IP 체크섬은 <b>헤더 부분의 오류</b>만 검사합니다. 반면 TCP/UDP 체크섬은 데이터(Payload)까지 포함하여 데이터 전체가 깨지지 않았는지 확인하기 때문에 전송의 신뢰성을 위해 두 번 확인합니다.
</div>
</details>