# 웹 스토리지
웹 스토리지는 웹 브라우저의 저장소로, 서버가 아닌 클라이언트(브라우저)에 데이터를 저장할 수 있도록 지원하는 HTML5의 기능이다. 

용량은 약 5MB이며, 서버 전송이 발생하지 않아 네트워크 부하가 적고 속도가 빠름.

## 로컬 스토리지 (LocalStorage)
브라우저 내에 `{ Key : Value }` 형태로 데이터를 저장하며, 특정 **오리진(Origin)**에 종속된다.


**특징:**

- **영속성**: 브라우저를 닫거나 컴퓨터를 재부팅해도 데이터가 사라지지 않음. (만료 기한 없음)

- **오리진 내 공유**: 같은 오리진(도메인, 프로토콜, 포트가 같음)이라면 모든 창과 탭에서 데이터를 공유.

- 예시: '오늘 하루 보지 않기' 설정, 자동 로그인 아이디 저장, UI 테마 설정(다크모드) 등.

## 세션 스토리지 (SessionStorage)
로컬 스토리지와 유사하나, 데이터의 유효 범위가 세션(탭/윈도우) 단위이다.

**특징:**

- **독립성**: 같은 오리진이라도 탭마다 데이터가 독립적으로 관리.

- **만료**: 탭이나 브라우저 창을 닫으면 데이터가 즉시 삭제.

- 예시: 입력 폼 임시 저장(글쓰기 도중 새로고침 대비), 일회성 인증 정보 등.

## 사용 방법 (JavaScript API)
```javascript
두 스토리지 모두 동일한 메서드를 사용합니다.
```javascript
// 데이터 저장
localStorage.setItem('name', 'gemini');
// 데이터 가져오기
const user = localStorage.getItem('name');
// 특정 데이터 삭제
localStorage.removeItem('name');
// 모든 데이터 초기화
localStorage.clear();
```

# 오리진(Origin)이란?
브라우저가 데이터의 출처를 확인하는 기준. 보안 정책인 **SOP(Same-Origin Policy)**에 따라, 오리진이 일치해야만 데이터에 접근할 수 있다.

- **구성 요소**: `Protocol` + `Host(Domain)` + `Port`

**예시**: `https://naver.com:443` 일 때

- `https://naver.com:443` (전부 일치) → 같은 오리진 (접근 가능)

- `http://naver.com:443` (Protocol이 다름) → 다른 오리진 (접근 불가)

- `https://blog.naver.com:443` (Domain이 다름) → 다른 오리진 (접근 불가)

- `https://naver.com:8080` (Port가 다름) → 다른 오리진 (접근 불가)

> URL 뒤의 ?query=iphone 같은 Query String은 오리진 판정에 영향을 주지 않는다. 즉, 검색어가 달라도 사이트 주소만 같으면 로컬스토리지 데이터를 공유할 수 있다.

# 쿠키 (Cookie)
서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각. 브라우저는 이 조각을 저장해두었다가, 동일한 서버에 재요청시 요청 헤더(Cookie)에 담아 보낸다.

최대 용량은 4KB이고, 서버와 클라이언트 모두 조작 가능하다. (보통 서버에서 만료시간 등을 설정 및 조작)

로그인, 장바구니, 사용자 커스터마이징, 사용자 행동 분석(주로 개인화된 광고에 활용되는 것들)에 사용된다.

## 동작 방식
1. 클라이언트: 서버에 Request
2. 서버: 요청 확인 후 Response 헤더에 `Set-Cookie`를 설정해서 보냄
3. 클라이언트: 브라우저에 쿠키를 저장하고, 이후 모든 요청 헤더에 `Cookie`를 자동 포함하여 전송
- 브라우저가 종료되어도 만료되지 않은 쿠키라면 클라이언트에서 보관하고 있음

## 쿠키의 생명주기
- **세션 쿠키**: `Expires`나 `Max-Age`를 설정하지 않음. 브라우저 종료 시 삭제.
- **영구 쿠키**: 만료 날짜를 지정함. 브라우저를 닫아도 기한까지 유지.

## 보안
|속성|설명|방어하는 공격|
|--|--|--|
|HttpOnly|JS(document.cookie) 접근 차단|XSS (데이터 탈취 방지)|
|Secure|HTTPS 프로토콜에서만 전송|Sniffing (중간자 공격 방지)|
|SameSite|요청 출처에 따른 쿠키 전송 제한|CSRF (위조 요청 방지)|

### 쿠키의 시큐어 코딩 예시
쿠키 - 세션으로 로그인을 처리하는 경우

1. cookie에 세션ID를 담을 때 이 세션ID 기반으로 클라이언트의 개인정보를 유추할 수 
없게 해야 한다.
2. 자바스크립트로는 파악할 수 없게 http only 옵션을 걸고 https로만 쿠키를 주고받을 수 있게 secure 옵션을 걸어야 한다.
3. 일정 시간의 세션 타임아웃을 걸어야 한다. 

## 제어권
클라이언트(JS)에서도 쿠키 생성이 가능하지만, 서버가 제어권을 갖는 것을 권장한다. 

- 클라이언트는 HttpOnly를 설정할 수 없고, 데이터 위조가 쉬움.
- 민감 정보(세션 ID 등)는 반드시 서버가 Set-Cookie로 생성하고 보안 옵션을 강제해야 함.

## 법적 준수 사항 (KISA 지침)
방문 기록, 접속 로그 등은 '최소 수집' 원칙을 준수해야 한다. 

광고성 타겟팅이나 행태 정보 분석을 위해 쿠키를 쓸 경우, 사용자에게 고지하고 선택적 동의를 받아야 함. (쿠키 허용 알림창 등)

# 로컬 vs 세션 vs 쿠키
## 공통점

- 서버 부하 방지: 자주 필요한 데이터를 브라우저에 저장해두면 매번 서버에 요청할 필요가 없음.
- 성능 향상: 캐싱으로 인해 네트워크를 타지 않고 로컬에서 바로 읽어오므로 웹사이트 속도가 빨라짐.
- 개인화: 사용자가 설정한 다크모드, 언어 설정, 로그인 상태 등을 기억하여 맞춤형 서비스를 제공 가능.

## 차이점

 |  | 쿠키 | 로컬 스토리지 | 세션 스토리지 |
| :--- | :--- | :--- | :--- |
| **최대 저장 용량** | **최대 4KB** | **최대 5MB**  | **최대 5MB**|
| **지원 버전** | HTML4 이상 | HTML5 이상 | HTML5 이상 |
| **접근 범위** | 동일 오리진 (모든 창/탭 공유) | 동일 오리진 (모든 창/탭 공유) | **동일 탭** 내에서만 공유 |
| **만료 기한** | 설정 가능 (세션/영구) | **영구적** (수동 삭제 시까지) | **탭/윈도우 종료 시 삭제** |
| **설정 주체** | **서버** 및 클라이언트 | 클라이언트 | 클라이언트 |
| **서버 전송** | **매 HTTP 요청마다 자동 전송** | 전송되지 않음 | 전송되지 않음 |

* **쿠키와 로컬 스토리지**: 동일 오리진(`Protocol` + `Host` + `Port`)이라면 여러 창이나 탭 사이에서 데이터를 공유하며, 브라우저를 껐다 켜도 데이터가 유지(영구 쿠키/로컬 스토리지 한정).

* **세션 스토리지**: 오리진이 같더라도 **탭 단위로 독립적**. 즉, 같은 사이트를 다른 탭에 열면 서로의 세션 스토리지 데이터에 접근할 수 없음.

# 종류별 적용 예시
1. **인증 정보(세션 ID, 토큰)**: 서버와의 통신이 필요하고 보안 속성(`HttpOnly`, `Secure`)을 적용해야 하므로 **쿠키**를 사용.
2. **비로그인 장바구니 / UI 설정**: 서버가 실시간으로 알 필요는 없지만 유지되어야 하므로 **로컬 스토리지**를 사용.
3. **일회성 폼 데이터 / 일시적인 상태**: 보안이 중요하지 않고 창을 닫으면 사라져도 되는 정보는 **세션 스토리지**를 사용.




# 퀴즈
Q1. 로컬 스토리지와 쿠키의 네트워크 측면의 차이점은?

A: 쿠키는 모든 HTTP 요청 시 헤더에 실려 서버로 자동 전송되지만, 웹 스토리지는 클라이언트에만 머뭅니다. 따라서 쿠키가 많아지면 네트워크 부하가 발생할 수 있습니다.

Q2. JWT를 로컬 스토리지에 저장하면 안 된다는 의견이 많은데, 그 이유는?

A: 웹 스토리지는 JS로 접근이 가능하기 때문에 XSS 공격 시 토큰이 탈취될 위험이 큽니다. 보안이 중요하다면 HttpOnly 쿠키에 담는 것이 권장됩니다.

Q3. HttpOnly만 설정하면 쿠키 보안은 완벽한가요?

A: 아니요. HttpOnly는 JS 접근만 막을 뿐, 네트워크 패킷을 가로채는 스니핑에는 취약합니다. 따라서 반드시 HTTPS를 강제하는 Secure 옵션을 병행해야 합니다.

Q4. 브라우저의 '세션 스토리지'와 서버의 '세션'은 어떤 관계인가요?

A: 이름은 같지만 별개의 개념입니다. 세션 스토리지는 브라우저 탭 내의 데이터 저장소이고, 서버의 세션은 서버 측에서 유저 정보를 식별하기 위한 메커니즘입니다. 보통 서버 세션을 유지하기 위해 '세션 ID'를 쿠키에 담아 주고받습니다.